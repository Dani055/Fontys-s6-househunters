<!DOCTYPE html> <html> <body> <p>The image_build stage of the CI/CD pipeline deals building the docker images required to deploy the application and pushing them to the docker hub.</p><p><img src="https://portfolio.drieam.app/api/public/v1/blobs/545ea1b8-b9c6-4fdf-9e1d-cab50ed05fbf/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBMXV6QXc9PSIsImV4cCI6bnVsbCwicHVyIjoiYmxvYl9pZCJ9fQ==--9a147e5fcdf8a5151116ab39437215ec6e4fe132/image_2024-05-25_224939822.png" data-key="72u0nri71txrls7fpynrxqu51bzi"></p><p>This stage only runs on the main branch, as it is unneeded in other branches and review environment are not implemented, since they are overkill for a one-man operation like the individual project.</p><p>The code for building and pushing the docker images in the gitlab CI definition file is as follows:</p><pre><code>build-docker-production: stage: image_build rules: - if: $CI_COMMIT_BRANCH == "main" image: docker:25.0.3 script: - docker login -u="${DOCKER_USERNAME}" -p="${DOCKER_PASSWORD}" - docker compose -f docker-compose-e2e.yml build - docker image tag s6-househunters-auth-ms ${DOCKER_USERNAME}/s6-househunters-auth-ms:latest # Push - docker push ${DOCKER_USERNAME}/s6-househunters-auth-ms:latest ...</code></pre><p>The stage logins in the docker hub account using credentials securely saved as GitLab secrets. Afterwards it builds the required images with the help of the <code>docker-compose-e2e.yml</code> file, tags them and pushes them to the hub with the <code>latest</code> tag.</p> </body> </html>